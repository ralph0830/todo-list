<!-- Header -->
<div class="text-center mb-8 animate-slide-in-down">
  <h2 class="text-3xl font-bold text-gray-800 mb-2">ë°˜ë³µ í• ì¼ ê´€ë¦¬</h2>
  <p class="text-gray-600">ê·œì¹™ì ì¸ í•  ì¼ì„ ìë™ìœ¼ë¡œ ìƒì„±í•´ë³´ì„¸ìš” ğŸ”„</p>
</div>

<!-- Navigation -->
<div class="mb-6 text-center">
  <%= link_to "â† ì¼ë°˜ í• ì¼ë¡œ ëŒì•„ê°€ê¸°", root_path, 
      class: "inline-flex items-center px-4 py-2 text-sm text-indigo-600 hover:text-indigo-700 font-medium" %>
</div>

<!-- Statistics -->
<div class="mb-8 animate-fade-in">
  <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-4">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0">
      <div class="flex items-center space-x-3">
        <div class="w-8 h-8 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center flex-shrink-0">
          <span class="text-white text-sm">ğŸ”„</span>
        </div>
        <div class="text-sm text-gray-700">
          <span class="font-semibold">ë°˜ë³µ í• ì¼ í˜„í™©:</span>
          <% active_count = @recurring_tasks.select(&:active?).count %>
          <% inactive_count = @recurring_tasks.count - active_count %>
          <span class="text-indigo-600 font-bold"><%= active_count %>ê°œ í™œì„±</span>
        </div>
      </div>
      <div class="flex items-center justify-center sm:justify-end space-x-3 sm:space-x-4 text-sm">
        <div class="flex items-center space-x-1">
          <span class="w-3 h-3 bg-green-400 rounded-full flex-shrink-0"></span>
          <span class="text-gray-600 whitespace-nowrap">í™œì„± <%= active_count %></span>
        </div>
        <div class="flex items-center space-x-1">
          <span class="w-3 h-3 bg-gray-400 rounded-full flex-shrink-0"></span>
          <span class="text-gray-600 whitespace-nowrap">ë¹„í™œì„± <%= inactive_count %></span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- New Recurring Task Form -->
<div class="mb-8 animate-slide-in-up">
  <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6 glass hover-glow">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">ìƒˆ ë°˜ë³µ í• ì¼ ì¶”ê°€</h3>
    
    <%= form_with(model: @recurring_task, url: recurring_tasks_path, method: :post, local: true, class: "space-y-4") do |form| %>
      <!-- í• ì¼ ë‚´ìš© -->
      <div>
        <%= form.label :content, "í• ì¼ ë‚´ìš©", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.text_field :content, 
            placeholder: "ë°˜ë³µí•  í• ì¼ì„ ì…ë ¥í•˜ì„¸ìš”...", 
            class: "w-full px-4 py-3 text-lg border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 bg-gray-50 focus:bg-white custom-input focus-ring touch-friendly",
            required: true,
            maxlength: 200 %>
      </div>

      <!-- ë°˜ë³µ ì£¼ê¸° -->
      <div>
        <%= form.label :frequency, "ë°˜ë³µ ì£¼ê¸°", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.select :frequency, 
            options_for_select([
              ['ë§¤ì¼', 'daily'],
              ['ë§¤ì£¼', 'weekly'], 
              ['ë§¤ì›”', 'monthly']
            ], @recurring_task.frequency),
            { prompt: "ë°˜ë³µ ì£¼ê¸°ë¥¼ ì„ íƒí•˜ì„¸ìš”" },
            { class: "w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 bg-gray-50 focus:bg-white",
              required: true,
              onchange: "toggleFrequencyOptions(this.value)" } %>
      </div>

      <!-- ì£¼ê°„ ë°˜ë³µ ì˜µì…˜ -->
      <div id="weekly-options" style="display: none;">
        <%= form.label :weekdays, "ë°˜ë³µí•  ìš”ì¼", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <div class="flex flex-wrap gap-2">
          <% %w[ì¼ ì›” í™” ìˆ˜ ëª© ê¸ˆ í† ].each_with_index do |day, index| %>
            <label class="flex items-center">
              <%= check_box_tag "weekdays[]", index, false, 
                  class: "sr-only peer", 
                  id: "weekday_#{index}" %>
              <div class="px-3 py-2 text-sm border border-gray-300 rounded-lg cursor-pointer peer-checked:bg-indigo-500 peer-checked:text-white peer-checked:border-indigo-500 transition-all">
                <%= day %>
              </div>
            </label>
          <% end %>
        </div>
      </div>

      <!-- ì›”ê°„ ë°˜ë³µ ì˜µì…˜ -->
      <div id="monthly-options" style="display: none;">
        <%= form.label :monthly_day, "ë§¤ì›” ë°˜ë³µí•  ì¼ì", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.number_field :monthly_day,
            min: 1, max: 31,
            placeholder: "1-31",
            class: "w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 bg-gray-50 focus:bg-white" %>
      </div>

      <!-- ì„¤ëª… (ì„ íƒì‚¬í•­) -->
      <div>
        <%= form.label :description, "ì„¤ëª… (ì„ íƒì‚¬í•­)", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.text_area :description,
            placeholder: "ë°˜ë³µ í• ì¼ì— ëŒ€í•œ ì¶”ê°€ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”...",
            rows: 2,
            class: "w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200 bg-gray-50 focus:bg-white resize-none" %>
      </div>

      <div class="flex justify-end">
        <%= form.submit "ë°˜ë³µ í• ì¼ ì¶”ê°€", 
            class: "px-6 py-3 bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-semibold rounded-xl hover:from-purple-600 hover:to-indigo-700 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transform hover:scale-105 transition-all duration-200 shadow-lg cursor-pointer touch-friendly hover-lift focus-ring" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Existing Recurring Tasks -->
<div class="space-y-6">
  <% if @recurring_tasks.any? %>
    <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6">
      <div class="flex items-center mb-6">
        <div class="w-8 h-8 bg-gradient-to-br from-purple-400 to-purple-600 rounded-lg flex items-center justify-center mr-3">
          <span class="text-white text-sm font-bold">ğŸ“‹</span>
        </div>
        <h3 class="text-xl font-bold text-gray-800">ë“±ë¡ëœ ë°˜ë³µ í• ì¼</h3>
        <span class="ml-auto bg-purple-100 text-purple-800 text-sm font-medium px-3 py-1 rounded-full">
          <%= @recurring_tasks.count %>ê°œ
        </span>
      </div>
      
      <div class="space-y-3">
        <% @recurring_tasks.each_with_index do |recurring_task, index| %>
          <div class="group bg-gray-50/80 hover:bg-white rounded-xl p-4 transition-all duration-200 hover:shadow-md border border-gray-100 hover-lift mobile-card animate-fade-in touch-friendly <%= 'opacity-50' unless recurring_task.active? %>" style="animation-delay: <%= (index * 0.1) %>s;">
            <div class="flex items-center justify-between">
              <div class="flex-grow">
                <div class="flex items-center space-x-3">
                  <!-- Active Status Toggle -->
                  <%= link_to toggle_active_recurring_task_path(recurring_task), method: :patch, 
                      class: "flex items-center space-x-2 hover:bg-gray-100 rounded-lg p-1 transition-colors" do %>
                    <div class="w-6 h-6 rounded-full flex items-center justify-center <%= recurring_task.active? ? 'bg-green-500' : 'bg-gray-400' %> transition-colors">
                      <span class="text-white text-xs font-bold"><%= recurring_task.active? ? 'âœ“' : 'â¸' %></span>
                    </div>
                  <% end %>
                  
                  <div class="flex-grow">
                    <h4 class="text-lg font-medium text-gray-800 <%= 'line-through' unless recurring_task.active? %>">
                      <%= recurring_task.content %>
                    </h4>
                    <div class="flex items-center space-x-2 text-sm text-gray-500 mt-1">
                      <span class="px-2 py-1 bg-indigo-100 text-indigo-800 rounded-full font-medium">
                        <%= case recurring_task.frequency
                            when 'daily' then 'ë§¤ì¼'
                            when 'weekly' then "ë§¤ì£¼ #{recurring_task.weekdays_array.map{|d| %w[ì¼ ì›” í™” ìˆ˜ ëª© ê¸ˆ í† ][d]}.join(', ')}"
                            when 'monthly' then "ë§¤ì›” #{recurring_task.monthly_day}ì¼"
                            end %>
                      </span>
                      <% if recurring_task.last_generated_at %>
                        <span class="text-gray-400">ë§ˆì§€ë§‰ ìƒì„±: <%= recurring_task.last_generated_at.strftime('%m/%d %H:%M') %></span>
                      <% end %>
                    </div>
                    <% if recurring_task.description.present? %>
                      <p class="text-sm text-gray-600 mt-1"><%= recurring_task.description %></p>
                    <% end %>
                  </div>
                </div>
              </div>
              
              <div class="flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                <%= link_to "ìˆ˜ì •", edit_recurring_task_path(recurring_task),
                    class: "px-3 py-1 text-sm bg-blue-100 text-blue-700 hover:bg-blue-200 rounded-lg transition-colors touch-friendly" %>
                <%= link_to "ì‚­ì œ", recurring_task_path(recurring_task), 
                    method: :delete,
                    confirm: "ì •ë§ë¡œ ì´ ë°˜ë³µ í• ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
                    class: "px-3 py-1 text-sm bg-red-100 text-red-700 hover:bg-red-200 rounded-lg transition-colors touch-friendly" %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% else %>
    <!-- Empty State -->
    <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-8 text-center">
      <div class="w-20 h-20 bg-gradient-to-br from-purple-100 to-purple-200 rounded-full flex items-center justify-center mx-auto mb-4">
        <span class="text-purple-400 text-3xl">ğŸ”„</span>
      </div>
      <h3 class="text-xl font-semibold text-gray-700 mb-2">ë“±ë¡ëœ ë°˜ë³µ í• ì¼ì´ ì—†ìŠµë‹ˆë‹¤</h3>
      <p class="text-gray-500">ìƒˆë¡œìš´ ë°˜ë³µ í• ì¼ì„ ì¶”ê°€í•´ì„œ ìë™í™”ëœ í• ì¼ ê´€ë¦¬ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!</p>
    </div>
  <% end %>
</div>

<script>
function toggleFrequencyOptions(frequency) {
  const weeklyOptions = document.getElementById('weekly-options');
  const monthlyOptions = document.getElementById('monthly-options');
  
  // ëª¨ë“  ì˜µì…˜ ìˆ¨ê¸°ê¸°
  weeklyOptions.style.display = 'none';
  monthlyOptions.style.display = 'none';
  
  // ì„ íƒëœ ì£¼ê¸°ì— ë”°ë¼ ì˜µì…˜ í‘œì‹œ
  if (frequency === 'weekly') {
    weeklyOptions.style.display = 'block';
  } else if (frequency === 'monthly') {
    monthlyOptions.style.display = 'block';
  }
}
</script>